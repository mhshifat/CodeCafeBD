!function(e){var s={};function t(r){if(s[r])return s[r].exports;var a=s[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=s,t.d=function(e,s,r){t.o(e,s)||Object.defineProperty(e,s,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,s){if(1&s&&(e=t(e)),8&s)return e;if(4&s&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&s&&"string"!=typeof e)for(var a in e)t.d(r,a,function(s){return e[s]}.bind(null,a));return r},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},t.p="",t(t.s=15)}([function(e,s){e.exports=require("mongoose")},function(e,s){e.exports=require("fs")},function(e,s){e.exports=require("express")},function(e,s){e.exports=require("path")},function(e,s){e.exports=require("jsonwebtoken")},function(e,s){e.exports=require("dotenv")},function(e,s){e.exports=require("colors")},function(e,s){e.exports=require("nodemailer")},function(e){e.exports={b:"server",c:"1.0.0",a:"Personal portfolio website"}},function(e,s){e.exports=require("body-parser")},function(e,s){e.exports=require("bcryptjs")},function(e,s){e.exports=require("express-fileupload")},function(e,s){e.exports=require("morgan")},function(e,s){e.exports=require("helmet")},function(e,s){e.exports=require("cookie-parser")},function(e,s,t){"use strict";t.r(s);var r=t(3),a=t.n(r),n=t(2),i=t.n(n),o=t(11),l=t.n(o),c=t(6),d=t.n(c),u=t(12),p=t.n(u),m=t(13),g=t.n(m),f=t(9),b=t.n(f),y=t(14),h=t.n(y),v=t(8);const w=process.env.PORT||5e3;var j=t(4),x=t.n(j),S=t(10),q=t.n(S);var O=({username:e,email:s,password:t})=>{const r={};return e.includes(t)&&(r.username="Username and password can't be the same"),s.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||(r.email="Please provide a valid email address"),(e.includes("<script>")||e.includes("alert()"))&&(r.username="Please provide a valid username"),(s.includes("<script>")||s.includes("alert()"))&&(r.email="Please provide a valid email address"),(t.includes("<script>")||t.includes("alert()"))&&(r.password="Please provide a valid password"),(e.length<8||e.length>15)&&(r.username="Username must be between 8 to 15 characters long"),t.length<10&&(r.password="Password must be at least 10 characters long"),e||(r.username="Username field is required"),s||(r.email="Email field is required"),t||(r.password="Password field is required"),{isValid:!(Object.keys(r).length>0),errors:r}};var P=({email:e,password:s})=>{const t={};return e.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||(t.email="Please provide a valid email address"),(e.includes("<script>")||e.includes("alert()"))&&(t.email="Please provide a valid email address"),(s.includes("<script>")||s.includes("alert()"))&&(t.password="Please provide a valid password"),e||(t.email="Email field is required"),s||(t.password="Password field is required"),{isValid:!(Object.keys(t).length>0),errors:t}},k=t(0),E=t.n(k);const T=new E.a.Schema({username:{type:String,required:!0,trim:!0},email:{type:String,required:!0,trim:!0,unique:!0},password:{type:String,required:!0,trim:!0},isAdmin:{type:Boolean,default:!1},projects:[{type:E.a.Schema.Types.ObjectId,ref:"Project"}],posts:[{type:E.a.Schema.Types.ObjectId,ref:"Post"}],categories:[{type:E.a.Schema.Types.ObjectId,ref:"Category"}],date:{type:Date,default:Date.now}});var _=E.a.model("User",T),$=t(7),A=t.n($);t(5).config();t(5).config();const C=i.a.Router();C.get("/user/:token",async(e,s)=>{try{const t=e.params.token.split("=");if("ccbd_user"===t[0]){const e=await x.a.verify(t[1],process.env.JWT_SECRET);return s.status(200).json({success:!0,user:e})}}catch(e){console.log(e)}}),C.post("/login",async(e,s)=>{try{const{email:t,password:r}=e.body,{isValid:a,errors:n}=P(e.body);if(!a)return s.status(400).json({success:!1,errors:n});const i=await _.findOne({email:t});if(!i)return n.email="A user of this email doesn't exist",s.status(400).json({success:!1,errors:n});if(!await q.a.compare(r,i.password))return n.password="Provided password doesn't match",s.status(400).json({success:!1,errors:n});const o={id:i._id,username:i.username,email:i.email,isAdmin:i.isAdmin},l=await x.a.sign(o,process.env.JWT_SECRET);return s.cookie("ccbd_user",l,{maxAge:2592e6}),s.status(200).json({success:!0,data:{message:"Welcome, you are now logged in"},user:o})}catch(e){s.status(500).json({success:!1,errors:{error:"Something went wrong, please try again later"}})}}),C.post("/register",async(e,s)=>{try{const{username:t,email:r}=e.body,a=`${e.protocol}://${e.headers.host}`,{isValid:n,errors:i}=O(e.body);if(!n)return s.status(400).json({success:!1,errors:i});if(await _.findOne({email:r}))return i.email="A user of this email already exists",s.status(400).json({success:!1,errors:i});if((async(e,s,t,r)=>{try{const a=A.a.createTransport({host:"smtp.gmail.com",port:465,secure:!0,auth:{user:process.env.GOOGLE_USER,pass:process.env.GOOGLE_PASS},tls:{rejectUnauthorized:!1}}),n={from:process.env.GOOGLE_USER,to:s,subject:"Email confirmation to verify your account",html:((e,s,t)=>`\n  <!DOCTYPE html>\n  <html lang="en">\n  <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <meta http-equiv="X-UA-Compatible" content="ie=edge">\n      <title>Email Template</title>\n      <style>\n          body {\n              padding: 0;\n              margin: 0;\n              font-family: "Roboto", sans-sarif;\n          }\n          a {\n              text-decoration: none;\n          }\n          table,td {\n              border-collapse: collapse;\n              padding: 0;\n          }\n          .container {\n              width: 100%;\n              height: 100%;\n              background-color: #eaeaea;\n          }\n          .wrapper {\n              display: block;\n              width: 500px;\n              height: auto;\n              background-color: #ffffff;\n              margin: 100px auto;\n              border: 2px solid #28b485;\n              border-radius: 3px;\n          }\n          .header {\n              width: 500px !important;\n              height: auto !important;\n              background-color: #28b485;\n              color: #ffffff;\n              padding: 30px;\n              text-align: center;\n          }\n          .header-title {\n              font-size: 25px;\n              letter-spacing: -1px;\n          }\n          .verify-text {\n              font-size: 20px;\n              color: #28b485;\n          }\n          .verify-name {\n              font-size: 16px;\n              color: #28b485;\n          }\n          .verify-desc {\n              font-size: 15px;\n              color: #868686;\n              font-weight: 400;\n          }\n          .verify-link {\n              display: inline-block;\n              padding: 10px 20px;\n              background-color: #28b485;\n              color: #ffffff;\n              border-radius: 3px;\n              margin: 20px 0 50px 0;\n              font-size: 15px;\n          }\n      </style>\n  </head>\n  <body style="padding: 0;margin: 0;font-family: &quot;Roboto&quot;, sans-sarif;">\n      <table class="container" style="border-collapse: collapse;padding: 0;width: 100%;height: 100%;background-color: #eaeaea;">\n          <tbody>\n              <tr>\n                  <td class="wrapper" align="center" style="border-collapse: collapse;padding: 0;display: block;width: 500px;height: auto;background-color: #ffffff;margin: 100px auto;border: 2px solid #28b485;border-radius: 3px;">\n                      <table style="border-collapse: collapse;padding: 0;">\n                          <tbody>\n                              <tr>\n                                  <td class="header" style="border-collapse: collapse;padding: 30px;background-color: #28b485;color: #ffffff;text-align: center;width: 500px !important;height: auto !important;"><h1 class="header-title" style="font-size: 25px;letter-spacing: -1px;">CODECAFEBD</h1></td>\n                              </tr>\n                          </tbody>\n                      </table>\n                      <table style="border-collapse: collapse;padding: 0;">\n                          <tbody>\n                              <tr>\n                                  <td align="center" style="border-collapse: collapse;padding: 0;"><h1 class="verify-text" style="font-size: 20px;color: #28b485;">Verify Email</h1></td>\n                              </tr>\n                              <tr>\n                                  <td align="center" style="border-collapse: collapse;padding: 0;"><h1 class="verify-name" style="font-size: 16px;color: #28b485;">( Hi, ${t} )</h1></td>\n                              </tr>\n                              <tr>\n                                  <td align="center" style="border-collapse: collapse;padding: 0;"><h4 class="verify-desc" style="font-size: 15px;color: #868686;font-weight: 400;">Thanks for creating an account with us.<br>To continue please verify your email with us.</h4></td>\n                              </tr>\n                              <tr>\n                                  <td align="center" style="border-collapse: collapse;padding: 0;"><a href="${e}/api/auth/verify/${s}" target="_blank" class="verify-link" style="text-decoration: none;display: inline-block;padding: 10px 20px;background-color: #28b485;color: #ffffff;border-radius: 3px;margin: 20px 0 50px 0;font-size: 15px;">Verify Your Email</a></td>\n                              </tr>\n                              <tr>\n                                  <td align="center" style="border-collapse: collapse;padding: 0;"><h4 class="verify-desc" style="font-size: 15px;color: #868686;font-weight: 400;">Email validation time 1 hour.</h4></td>\n                              </tr>\n                          </tbody>\n                      </table>\n                  </td>\n              </tr>\n          </tbody>\n      </table>\n  </body>\n  </html>\n  `)(r,t,e)};return await a.sendMail(n)}catch(e){return e}})(t,r,await x.a.sign(e.body,process.env.JWT_SECRET,{expiresIn:"1h"}),a))return s.status(200).json({success:!0,data:{message:"Please verify your email address"}})}catch(e){s.status(500).json({success:!1,errors:{error:"Something went wrong, please try again later"}})}}),C.get("/verify/:token",async(e,s)=>{try{const t=e.params.token,{username:r,email:a,password:n}=await x.a.verify(t,process.env.JWT_SECRET),i={username:r,email:a,password:await q.a.hash(n,10)};await _.create(i)&&s.redirect("/login")}catch(e){s.redirect("/register")}}),C.get("/logout",(e,s)=>{s.clearCookie("ccbd_user"),s.status(200).json({success:!0,data:{message:"You have been logged out"}})});var R=C,U=t(1),D=t.n(U);const G=new E.a.Schema({user:{type:E.a.Schema.Types.ObjectId,ref:"User"},name:{type:String,required:!0,trim:!0,unique:!0},category:{type:String,required:!0,trim:!0},website:{type:String,required:!0,trim:!0},github:{type:String,required:!0,trim:!0},image:{type:String,required:!0,trim:!0},date:{type:Date,default:Date.now}});var z=E.a.model("Project",G);var I=({name:e,category:s,website:t,github:r})=>{const a={};return(e.includes("<script>")||e.includes("alert()"))&&(a.name="Please provide a valid name"),(s.includes("<script>")||s.includes("alert()"))&&(a.category="Please provide a valid category"),(t.includes("<script>")||t.includes("alert()"))&&(a.website="Please provide a valid website link"),(r.includes("<script>")||r.includes("alert()"))&&(a.github="Please provide a valid github link"),e||(a.name="Name field is required"),s||(a.category="Category field is required"),t||(a.website="Website link is required"),r||(a.github="Github link is required"),{isValid:!(Object.keys(a).length>0),errors:a}};t(5).config();const V=i.a.Router();V.get("/",async(e,s)=>{try{const e=await z.find({}).sort({date:-1});if(e)return s.status(200).json({success:!0,projects:e})}catch(e){s.status(500).json({success:!1,errors:{error:"Something went wrong, please try again later"}})}}),V.post("/add",async(e,s)=>{try{const{isValid:t,errors:r}=I(e.body);if(!t)return s.status(400).json({success:!1,errors:r});if(null===e.files)return r.image="Please upload an image of the project",s.status(400).json({success:!1,errors:r});if([".png",".jpeg",".jpg"].filter(s=>e.files.files.name.endsWith(s)).length<=0)return r.image="Please upload a valid image file",s.status(400).json({success:!1,errors:r});const a=await x.a.decode(e.body.user,process.env.JWT_SECRET),n=await _.findById(a.id);if(!n.isAdmin)return r.error="You don't have permission to add a project",s.status(400).json({success:!1,errors:r});if(await z.findOne({name:e.body.name}))return r.error="A project of this name already exists",s.status(400).json({success:!1,errors:r});const i=e.files.files,o=i.name,l="CODECAFEBD-"+Date.now()+"-"+o;i.mv(`./client/build/images/projects/${l}`),i.mv(`./client/public/images/projects/${l}`);const c={user:n._id,name:e.body.name,category:e.body.category,website:e.body.website,github:e.body.github,image:l},d=await z.create(c);if(d)return n.projects.push(d),n.save(),s.status(200).json({success:!0,data:{message:"A new project has been created"},project:d})}catch(e){s.status(500).json({success:!1,errors:{error:"Something went wrong, please try again later"}})}}),V.get("/delete/:id",async(e,s)=>{try{const t=await z.findByIdAndDelete(e.params.id);return D.a.existsSync(a.a.resolve("client","build"))?D.a.unlinkSync(`./client/build/images/projects/${t.image}`):D.a.existsSync(a.a.resolve("client","public"))&&D.a.unlinkSync(`./client/public/images/projects/${t.image}`),s.status(200).json({success:!0,data:{message:"One project has been deleted"},project:t})}catch(e){s.status(500).json({success:!1,errors:{error:"Something went wrong, please try again later"}})}}),V.post("/update/:id",async(e,s)=>{try{const t=null!==e.files&&e.files.files,r=t.name,n="CODECAFEBD-"+Date.now()+"-"+r,{isValid:i,errors:o}=I(e.body);if(!i)return s.status(400).json({success:!1,errors:o});const l=await z.findById(e.params.id);if(null!==e.files){if([".png",".jpeg",".jpg"].filter(s=>e.files.files.name.endsWith(s)).length<=0)return o.image="Please upload a valid image file",s.status(400).json({success:!1,errors:o});D.a.existsSync(a.a.resolve("client","build"))?t.mv(`./client/build/images/projects/${n}`):D.a.existsSync(a.a.resolve("client","public"))&&t.mv(`./client/public/images/projects/${n}`),D.a.existsSync(a.a.resolve("client","build"))?D.a.unlinkSync(`./client/build/images/projects/${l.image}`):D.a.existsSync(a.a.resolve("client","public"))&&D.a.unlinkSync(`./client/public/images/projects/${l.image}`)}const c={name:e.body.name,category:e.body.category,website:e.body.website,github:e.body.github,image:null!==e.files?n:l.image},d=await z.findByIdAndUpdate(e.params.id,c,{new:!0});if(d)return s.status(200).json({success:!0,data:{message:"One project has been updated"},project:d})}catch(e){console.log(e),s.status(500).json({success:!1,errors:{error:"Something went wrong, please try again later"}})}});var M=V;var B=({name:e,email:s,subject:t,message:r})=>{const a={};return s.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||(a.email="Please provide a valid email address"),(e.includes("<script>")||e.includes("alert()"))&&(a.name="Please provide a valid name"),(s.includes("<script>")||s.includes("alert()"))&&(a.email="Please provide a valid email address"),(t.includes("<script>")||t.includes("alert()"))&&(a.subject="Please provide a valid subject"),(r.includes("<script>")||r.includes("alert()"))&&(a.message="Please provide a valid message"),e||(a.name="Name field is required"),s||(a.email="Email field is required"),t||(a.subject="Subject field is required"),r||(a.message="Message field is required"),{isValid:!(Object.keys(a).length>0),errors:a}};t(5).config();const W=i.a.Router();W.post("/contact",async(e,s)=>{try{const{name:t,email:r,subject:a,message:n}=e.body,{isValid:i,errors:o}=B(e.body);if(!i)return s.status(400).json({success:!1,errors:o});const l=A.a.createTransport({pool:!0,host:"smtp.gmail.com",port:465,secure:!0,auth:{user:process.env.GOOGLE_USER,pass:process.env.GOOGLE_PASS},tls:{rejectUnauthorized:!1}}),c={from:t+`<${r}>`,to:process.env.GOOGLE_USER,subject:"Message from codecafebd...",html:`\n        <h4>Name: ${t}</h4>\n        <h4>Email: ${r}</h4>\n        <h4>Subject: ${a}</h4>\n        <br>\n        <br>\n        <hr>\n        <br>\n        <h4>Message: </h4>\n        <p>${n}</p>\n      `};if(await l.sendMail(c))return s.status(200).json({success:!0,data:{message:"Your message has been sent"}})}catch(e){s.status(500).json({success:!1,messages:{message:"Something went wrong, please try again later"}})}});var L=W;t(5).config(),E.a.connect(process.env.MONGODB_URI,{useNewUrlParser:!0},()=>{console.log(d.a.magenta("==> A database connection has been established"))}),E.a.set("useCreateIndex","true");const F=i()();F.use(l()()),F.use(h()()),F.use(g()()),F.use(p()("tiny")),F.use(b.a.json()),F.use(b.a.urlencoded({extended:!0})),F.get("/api",(e,s)=>{s.status(200).json({name:v.b,version:v.c,description:v.a})}),F.use("/api/auth",R),F.use("/api/projects",M),F.use("/api",L),F.use(i.a.static("client/build")),F.get("*",(e,s)=>{s.sendFile(a.a.resolve("client","build","index.html"))}),F.listen(w,()=>{console.log(d.a.green(`==> The server is running on http://localhost:${w}`))})}]);